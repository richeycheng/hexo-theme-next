<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="重构,">










<meta name="description" content="概述 — 问题与方案Duplicate Code（重复代码）  Extract Method   Pull Up Method   From Template Method   Substitute Algorithm   Extract Class    Long Method（过长函数）  Extract Method   Replace Temp With Query   Introduce">
<meta name="keywords" content="重构">
<meta property="og:type" content="article">
<meta property="og:title" content="重构的艺术">
<meta property="og:url" content="http://yoursite.com/2019/09/19/重构/index.html">
<meta property="og:site_name" content="Richey&#39;s Notes">
<meta property="og:description" content="概述 — 问题与方案Duplicate Code（重复代码）  Extract Method   Pull Up Method   From Template Method   Substitute Algorithm   Extract Class    Long Method（过长函数）  Extract Method   Replace Temp With Query   Introduce">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-09-18T16:22:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="重构的艺术">
<meta name="twitter:description" content="概述 — 问题与方案Duplicate Code（重复代码）  Extract Method   Pull Up Method   From Template Method   Substitute Algorithm   Extract Class    Long Method（过长函数）  Extract Method   Replace Temp With Query   Introduce">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/09/19/重构/">





  <title>重构的艺术 | Richey's Notes</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Richey's Notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">温故知新</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/19/重构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RicheyCheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://ww3.sinaimg.cn/mw690/eab689f0jw8f12gq1h4q0j20ig0igjsh.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Richey's Notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">重构的艺术</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-19T00:06:32+08:00">
                2019-09-19
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/设计模式/" itemprop="url" rel="index">
                    <span itemprop="name">设计模式</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="概述-—-问题与方案"><a href="#概述-—-问题与方案" class="headerlink" title="概述 — 问题与方案"></a>概述 — 问题与方案</h4><p><strong>Duplicate Code（重复代码）</strong></p>
<ul>
<li>Extract Method  </li>
<li>Pull Up Method  </li>
<li>From Template Method  </li>
<li>Substitute Algorithm  </li>
<li>Extract Class  </li>
</ul>
<p><strong>Long Method（过长函数）</strong></p>
<ul>
<li>Extract Method  </li>
<li>Replace Temp With Query  </li>
<li>Introduce Parameter Object  </li>
<li>Replace Method with Method Object  </li>
<li>Decompose Conditional  </li>
</ul>
<p><strong>Long Class（过大的类）</strong></p>
<ul>
<li>Extract Class</li>
<li>Extract Subclass</li>
<li>Extract Interface</li>
<li>Duplicate Observed Data</li>
</ul>
<p><strong>Long Paramter List（过长参数列）</strong></p>
<ul>
<li>Replace Paraeter with Method</li>
<li>Preserve Whole Object</li>
<li>Introduce Parameter Object</li>
</ul>
<p><strong>Divergent Change（发散式变化）</strong></p>
<ul>
<li>Extract Class</li>
</ul>
<p><strong>Shotgun Surgery（霰xian弹式修改）</strong></p>
<ul>
<li>Move Method</li>
<li>Move Field</li>
<li>Inline Class</li>
</ul>
<p><strong>Feature Envy（依恋情结）</strong></p>
<ul>
<li>Move Method</li>
<li>Extract Method</li>
</ul>
<p><strong>Data Clumps（数据泥团）</strong></p>
<ul>
<li>Extract Class</li>
<li>Introduce Parameter Object</li>
<li>Preserve Whole Object</li>
</ul>
<p><strong>Primitive Obsession（基本类型偏执）</strong></p>
<ul>
<li>Replace Data Value with Object</li>
<li>Replace Type Code with Class</li>
<li>Replace Type Code with Subclass</li>
<li>Replace Type Code with State/Strategy</li>
<li>Extract Class</li>
<li>Introduce Parameter Object</li>
<li>Replace Array with Object</li>
</ul>
<p><strong>Switch Statements（switch惊悚现身）</strong></p>
<ul>
<li>Extract Method</li>
<li>Move Method</li>
<li>Replace Type Code with Subclasses</li>
<li>Replace Type Code with State/Strategy</li>
<li>Replace Conditional with Polymorphism</li>
<li>Replace Parameter with Explicit Methods</li>
<li>Introduce Null Object</li>
</ul>
<p><strong>Parallel Inheritace Hierarchies（平行继承体系）</strong></p>
<ul>
<li>Move Method</li>
<li>Move Field</li>
</ul>
<p><strong>Lazy Class（冗赘类）</strong></p>
<ul>
<li>Collapse Hierarchy</li>
<li>Inline Class</li>
</ul>
<p><strong>Speculative Generality（夸夸其谈未来性）</strong></p>
<ul>
<li>Collapse Hierarchy</li>
<li>Inline Class</li>
<li>Remove Parameter</li>
<li>Rename Method</li>
</ul>
<p><strong>Temporary Field（令人迷惑的暂时字段）</strong></p>
<ul>
<li>Extract Class</li>
<li>Introduce Null Object</li>
</ul>
<p><strong>Mesaage Chains（过度耦合的消息链）</strong></p>
<ul>
<li>Hidea Delegate</li>
<li>Extract Method</li>
<li>Move Method</li>
</ul>
<p><strong>Midle Man（中间人）</strong></p>
<ul>
<li>Remove Middle Man</li>
<li>Inline Method</li>
<li>Replace Delegation with Inheritance</li>
</ul>
<p><strong>Inappropriate Intimacy（狎xia昵关系）</strong></p>
<ul>
<li>Move Method</li>
<li>Move Field</li>
<li>Change Bidirectional Association to Unidirectional</li>
<li>Extract Class</li>
<li>Hide Delegate</li>
<li>Replace Inheritance with Delegation</li>
</ul>
<p><strong>Alternative Classes with Different Interfaces</strong></p>
<ul>
<li>Rename Method</li>
<li>Move Method</li>
<li>Extract Superclass</li>
</ul>
<p><strong>Incomplete Libarary Class（不完美的库类）</strong></p>
<ul>
<li>Introduce Foreign Method</li>
<li>Introduce Local Extension</li>
</ul>
<p><strong>Data Clas（纯稚的数据类）</strong></p>
<ul>
<li>Encapsulate Field</li>
<li>Encapsulate Collection</li>
<li>Remove Setting Method</li>
<li>Move Method</li>
<li>Extract method</li>
<li>Hide Method</li>
</ul>
<p><strong>Refused Bequest（被拒绝的遗赠）</strong></p>
<ul>
<li>Push Down Method</li>
<li>Push Down Field</li>
<li>Replace Inheritance with Delegation</li>
</ul>
<p><strong>Comments（过多的注释）</strong></p>
<ul>
<li>Extract Method</li>
<li>Rename Method</li>
<li>Introduce Assertion</li>
</ul>
<h4 id="重新组织函数"><a href="#重新组织函数" class="headerlink" title="重新组织函数"></a>重新组织函数</h4><h5 id="Extract-Method（提炼函数）"><a href="#Extract-Method（提炼函数）" class="headerlink" title="Extract Method（提炼函数）"></a>Extract Method（提炼函数）</h5><p>将代码放进一个独立函数中，并让函数名称解释该函数的用途。（提取时注意【无局部变量】与【有局部变量】的区别）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">(<span class="keyword">double</span> previousAmount)</span> </span>&#123;</span><br><span class="line">    Enumeration e = _orders.elements();</span><br><span class="line">    <span class="keyword">double</span> outstanding = previousAmount * <span class="number">1.2</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// print banner</span></span><br><span class="line">    System.out.println(<span class="string">"***********************"</span>);</span><br><span class="line">    System.out.println(<span class="string">"**** Customer Owes ****"</span>);</span><br><span class="line">    System.out.println(<span class="string">"***********************"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// calculate outstanding</span></span><br><span class="line">    <span class="keyword">while</span> (e.hasMoreElements()) &#123;</span><br><span class="line">        Order each = (Order) e.nextElement;</span><br><span class="line">        outstanding += each.getAmount();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// print detals</span></span><br><span class="line">    System.out.println(<span class="string">"name:"</span> + _name);</span><br><span class="line">    System.out.println(<span class="string">"amount:"</span> + outstanding);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printOwing</span><span class="params">(<span class="keyword">double</span> previousAmount)</span> </span>&#123;</span><br><span class="line">    printBanner();</span><br><span class="line">    <span class="keyword">double</span> outstanding = calcOutstanding(previousAmount * <span class="number">1.2</span>);</span><br><span class="line">    printDetails(outstanding);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printBanner</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"***********************"</span>);</span><br><span class="line">    System.out.println(<span class="string">"**** Customer Owes ****"</span>);</span><br><span class="line">    System.out.println(<span class="string">"***********************"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcOutstanding</span><span class="params">(<span class="keyword">double</span> initialValue)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result = initialValue;</span><br><span class="line">    Enumeration e = _orders.elements();</span><br><span class="line">    <span class="keyword">while</span> (e.hasMoreElements()) &#123;</span><br><span class="line">        Order each = (Order) e.nextElement;</span><br><span class="line">        result += each.getAmount();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">printDetails</span><span class="params">(<span class="keyword">double</span> amount)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">"name:"</span> + _name);</span><br><span class="line">    System.out.println(<span class="string">"amount:"</span> + amount);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Inline-Method（内联函数）"><a href="#Inline-Method（内联函数）" class="headerlink" title="Inline Method（内联函数）"></a>Inline Method（内联函数）</h5><p>在函数调用点插入函数本体，然后移除该函数。（间接层有其价值，但不是所有间接层都有价值）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getRating</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (moreThanFiveLateDeliveries()) ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">moreThanFiveLateDeliveries</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _numberOfLateDeliveries &gt; <span class="number">5</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getRating</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (_numberOfLateDeliveries &gt; <span class="number">5</span>) ? <span class="number">2</span> : <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Inline-Temp（内联临时变量）"><a href="#Inline-Temp（内联临时变量）" class="headerlink" title="Inline Temp（内联临时变量）"></a>Inline Temp（内联临时变量）</h5><p>将所有对该变量的引用动作，替换为对它赋值的那个表达式自身。（如果临时变量只是被一个简单的表达式赋值一次的话）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">double</span> basePrice = anOrder.basePrice();</span><br><span class="line"><span class="keyword">return</span> (basePrice &gt; <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">return</span> (anOrder.basePrice() &gt; <span class="number">1000</span>);</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Temp-with-Query（以查询取代临时变量）"><a href="#Replace-Temp-with-Query（以查询取代临时变量）" class="headerlink" title="Replace Temp with Query（以查询取代临时变量）"></a>Replace Temp with Query（以查询取代临时变量）</h5><p>将这个表达式提炼到一个独立函数中。将这个临时变量的所有引用点替换为对新函数的调用。此后，新函数就可被其他函数使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> basePrice = _quantity * _itemPrice;</span><br><span class="line">    <span class="keyword">double</span> discountFactor;</span><br><span class="line">    <span class="keyword">if</span> (basePrice &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        discountFactor = <span class="number">0.95</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        discountFactor = <span class="number">0.98</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> basePrice * discountFactor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice() * discountFactor();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">discountFactor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (basePrice() &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.95</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0.98</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">basePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _quantity * _itemPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Explaining-Variable（引入解释性变量）"><a href="#Introduce-Explaining-Variable（引入解释性变量）" class="headerlink" title="Introduce Explaining Variable（引入解释性变量）"></a>Introduce Explaining Variable（引入解释性变量）</h5><p>将复杂表达式（或其中一部分）的结果放进一个临时变量，以此变量名称来解释表达式用途。（当Extract Method需要花费更大工作量时使用）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// price is: base price - quantity discount + shipping</span></span><br><span class="line">    <span class="keyword">return</span> _quantity * _itemPrice - </span><br><span class="line">        Math.max(<span class="number">0</span>, _quantity - <span class="number">500</span>) * _itemPrice * <span class="number">0.05</span> + </span><br><span class="line">        Math.min(_quantity * _itemPrice * <span class="number">0.1</span>, <span class="number">100.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor with IEV=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> basePrice = _quantity * _itemPrice;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> quantityDiscount = Math.max(<span class="number">0</span>, _quantity - <span class="number">500</span>) * _itemPrice * <span class="number">0.05</span>;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">double</span> shipping = Math.min(basePrice * <span class="number">0.1</span>, <span class="number">100.0</span>);</span><br><span class="line">    <span class="keyword">return</span> basePrice - quantityDiscount + shipping;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor with EM=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calcPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> basePrice() - quantityDiscount() + shiping();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">quantityDiscount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Math.max(<span class="number">0</span>, _quantity - <span class="number">500</span>) * _itemPrice * <span class="number">0.05</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">shipping</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Math.min(basePrice() * <span class="number">0.1</span>, <span class="number">100.0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">basePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _quantity * _itemPrice;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Split-Temporary-Variable（分解临时变量）"><a href="#Split-Temporary-Variable（分解临时变量）" class="headerlink" title="Split Temporary Variable（分解临时变量）"></a>Split Temporary Variable（分解临时变量）</h5><p>如果某个临时变量被赋值超过一次，它既不是循环变量，也不被用于收集计算结果，则针对每次赋值，创造一个独立、对应的临时变量。（注：将独立使用的临时变量声明为final）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">double</span> temp = <span class="number">2</span> * (_height + _width);</span><br><span class="line">System.out.println(temp);</span><br><span class="line">temp = _height * _width;</span><br><span class="line">System.out.println(temp);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">double</span> perimeter = <span class="number">2</span> * (_height + _width);</span><br><span class="line">System.out.println(perimeter);</span><br><span class="line"><span class="keyword">final</span> <span class="keyword">double</span> area = _height * _width;</span><br><span class="line">System.out.println(area);</span><br></pre></td></tr></table></figure>

<h5 id="Remove-Assignments-to-Parameters（移除对参数的赋值）"><a href="#Remove-Assignments-to-Parameters（移除对参数的赋值）" class="headerlink" title="Remove Assignments to Parameters（移除对参数的赋值）"></a>Remove Assignments to Parameters（移除对参数的赋值）</h5><p>Java只有按值传递的方式，所以不要对参数赋值，而是以一个临时变量取代该参数的位置。（可以为参数加上关键词final，强制遵循“不对参数赋值”）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">discount</span><span class="params">(<span class="keyword">int</span> inputVal, <span class="keyword">int</span> quantity, <span class="keyword">int</span> yearToDate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (inputVal &gt; <span class="number">50</span>) inputVal -= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (quantity &gt; <span class="number">100</span>) inputVal -= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (yearToDate &gt; <span class="number">10000</span>) inputVal -= <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> inputVal;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">discount</span><span class="params">(<span class="keyword">final</span> <span class="keyword">int</span> inputVal, <span class="keyword">final</span> <span class="keyword">int</span> quantity, <span class="keyword">final</span> <span class="keyword">int</span> yearToDate)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> result = inputVal;</span><br><span class="line">    <span class="keyword">if</span> (inputVal &gt; <span class="number">50</span>) result -= <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (quantity &gt; <span class="number">100</span>) result -= <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> (yearToDate &gt; <span class="number">10000</span>) result -= <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Method-with-Method-Object（以函数对象取代函数）"><a href="#Replace-Method-with-Method-Object（以函数对象取代函数）" class="headerlink" title="Replace Method with Method Object（以函数对象取代函数）"></a>Replace Method with Method Object（以函数对象取代函数）</h5><p>将这个函数放进一个单独对象中，如此一来局部变量就成了对象内的字段。然后在同一个对象中将这个大型函数分解为多个小型函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">caclPrice</span><span class="params">(<span class="keyword">int</span> itemPrice, <span class="keyword">int</span> quantity, <span class="keyword">int</span> yearToDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> basePrice = (itemPrice * quantity) + otherPrice();</span><br><span class="line">        <span class="keyword">int</span> assurePrice = (itemPrice * yearToDate) + <span class="number">100</span>;</span><br><span class="line">        <span class="keyword">if</span> (assuerPrice - basePrice &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            basePrice -=<span class="number">20</span>;</span><br><span class="line">            yearToDate -= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> basePrice + <span class="number">2</span> * assurePrice + yearToDate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">otherPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PriceCalculator</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Object</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Order _order;</span><br><span class="line">    <span class="comment">// Arguments</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> itemPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> quantity;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> yearToDate;</span><br><span class="line">    <span class="comment">// Local variables</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> basePrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> assurePrice;</span><br><span class="line">    </span><br><span class="line">    PriceCalculator(Order order, <span class="keyword">int</span> itemPriceArg, <span class="keyword">int</span> quantityArg, <span class="keyword">int</span> yearToDateArg) &#123;</span><br><span class="line">        _order = order;</span><br><span class="line">        itemPrice = itemPriceArg;</span><br><span class="line">        quantity = quantityArg;</span><br><span class="line">        yearToDate = yearToDateArg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">compute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        basePrice = (itemPrice * quantity) + _order.otherPrice();</span><br><span class="line">        assurePrice = (itemPrice * yearToDate) + <span class="number">100</span>;</span><br><span class="line">        doSomethingImportant();</span><br><span class="line">        <span class="keyword">return</span> basePrice + <span class="number">2</span> * assurePrice + yearToDate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doSomethingImportant</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (assuerPrice - basePrice &gt; <span class="number">100</span>) &#123;</span><br><span class="line">            basePrice -=<span class="number">20</span>;</span><br><span class="line">            yearToDate -= <span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*---------------------------------------------*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">caclPrice</span><span class="params">(<span class="keyword">int</span> itemPrice, <span class="keyword">int</span> quantity, <span class="keyword">int</span> yearToDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PriceCalculator(<span class="keyword">this</span>, itemPrice, quantity, yearToDate).compute();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">otherPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// TODO</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Substitute-Algorithm（替换算法）"><a href="#Substitute-Algorithm（替换算法）" class="headerlink" title="Substitute Algorithm（替换算法）"></a>Substitute Algorithm（替换算法）</h5><p>将函数本体替换成为另一个更清晰的算法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundPerson</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (person[i].equals(<span class="string">"Jordan"</span>)) &#123;</span><br><span class="line">            retrn <span class="string">"Jordan"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (person[i].equals(<span class="string">"James"</span>)) &#123;</span><br><span class="line">            retrn <span class="string">"James"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (person[i].equals(<span class="string">"Kobe"</span>)) &#123;</span><br><span class="line">            retrn <span class="string">"Kobe"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundPerson</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    List candidates = Arrays.asList(<span class="keyword">new</span> String[] &#123;<span class="string">"Jordan"</span>, <span class="string">"James"</span>, <span class="string">"Kobe"</span>&#125;);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (candidates.contains(people[i])) &#123;</span><br><span class="line">            retrn people[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="在对象之间搬移特性"><a href="#在对象之间搬移特性" class="headerlink" title="在对象之间搬移特性"></a>在对象之间搬移特性</h4><h5 id="Move-Method（搬移函数）"><a href="#Move-Method（搬移函数）" class="headerlink" title="Move Method（搬移函数）"></a>Move Method（搬移函数）</h5><p>在该函数最常引用的类中建立一个有着类似行为的新函数。将旧函数变成一个单纯的委托函数，或是将旧函数完全移除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountType _type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _daysOverdrawn;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">overdraftCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (_type.isPremium()) &#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span> (_dayOverdrawn &gt; <span class="number">7</span>) &#123;</span><br><span class="line">                result += (_dayOverdrawn - <span class="number">7</span>) * <span class="number">0.85</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> _dayOverdrawn * <span class="number">1.75</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountType _type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _daysOverdrawn;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">bankCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> result = <span class="number">4.5</span>;</span><br><span class="line">        <span class="keyword">if</span> (_dayOverdrawn &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            result += _type.overdrawnCharge(_daysOverdrawn);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountType</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 如果被搬移函数调用了Account的另一个函数，则必须将源对象(即Account）传递给目标函数</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">overdraftCharge</span><span class="params">(<span class="keyword">int</span> dayOverdrawn)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (isPremium()) &#123;</span><br><span class="line">            <span class="keyword">double</span> result = <span class="number">10</span>;</span><br><span class="line">            <span class="keyword">if</span> (dayOverdrawn &gt; <span class="number">7</span>) &#123;</span><br><span class="line">                result += (dayOverdrawn - <span class="number">7</span>) * <span class="number">0.85</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> dayOverdrawn * <span class="number">1.75</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Move-Field（搬移字段）"><a href="#Move-Field（搬移字段）" class="headerlink" title="Move Field（搬移字段）"></a>Move Field（搬移字段）</h5><p>在目标类新建一个字段，修改源字段的所有用户，令它们改用新字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountType _type;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> _interestRate;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interestForAmountAndDays</span><span class="params">(<span class="keyword">double</span> amount, <span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _interestRate * amount * days / <span class="number">365</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> _interestRate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> AccountType _type;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">interestForAmountAndDays</span><span class="params">(<span class="keyword">double</span> amount, <span class="keyword">int</span> days)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getInterestRate() * amount * days / <span class="number">365</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getInterestRate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _type.getInterestRate();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Extract-Class（提炼类）"><a href="#Extract-Class（提炼类）" class="headerlink" title="Extract Class（提炼类）"></a>Extract Class（提炼类）</h5><p>建立一个新类，将相关的字段和函数从旧类搬移到新类。（一个类应该是一个清楚的抽象，处理一些明确的责任）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTelephoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">return</span> <span class="string">"("</span> + _officeAreaCode + <span class="string">")"</span> + _officeNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOfficeNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _officeNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOfficeNumber</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">        _officeNumber = teleNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getOfficeAreaCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _officeAreaCode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOfficeAreaCode</span><span class="params">(String areaCode)</span> </span>&#123;</span><br><span class="line">        _officeAreaCode = areaCode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String _name;</span><br><span class="line">    <span class="keyword">private</span> String _officeNumber;</span><br><span class="line">    <span class="keyword">private</span> String _officeAreaCode;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTelephoneNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _officeTelephone.getTelephoneNumer();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String _name;</span><br><span class="line">    <span class="keyword">private</span> TelephoneNumber _officeTelephone;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TelephoneNumber</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTelephoneNumer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"("</span> + _officeAreaCode + <span class="string">")"</span> + _officeNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNumber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _officeNumber;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNumber</span><span class="params">(String number)</span> </span>&#123;</span><br><span class="line">        _officeNumber = number;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getAreaCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _officeAreaCode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAreaCode</span><span class="params">(String areaCode)</span> </span>&#123;</span><br><span class="line">        _officeAreaCode = areaCode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> String _officeNumber;</span><br><span class="line">    <span class="keyword">private</span> String _officeAreaCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Inline-Class（将类内联化）"><a href="#Inline-Class（将类内联化）" class="headerlink" title="Inline Class（将类内联化）"></a>Inline Class（将类内联化）</h5><p>将这个类的所有特性搬移到另一个类中，然后移除原类。Inline Class与Extract Class相反，动机是：一个类不再承担足够责任、不再有单独存在的理由。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Inline Class是Extract Class的逆过程，源码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Hide-Delegate（隐藏“委托关系”）"><a href="#Hide-Delegate（隐藏“委托关系”）" class="headerlink" title="Hide Delegate（隐藏“委托关系”）"></a>Hide Delegate（隐藏“委托关系”）</h5><p>在服务类上建立客户所需的所有函数，用以隐藏委托关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    Department _department;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDepartment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _department;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepartment</span><span class="params">(Department department)</span> </span>&#123;</span><br><span class="line">        _department = department;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Person _manager;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Department</span><span class="params">(Person manager)</span> </span>&#123;</span><br><span class="line">        _manager = manager;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _manager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">Person manager = john.getDepartment().getManager();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    Department _department;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 完成了对Department所有函数的委托关系后移除</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * public Department getDepartment() &#123;</span></span><br><span class="line"><span class="comment">     *    return _department;</span></span><br><span class="line"><span class="comment">     * &#125;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDepartment</span><span class="params">(Department department)</span> </span>&#123;</span><br><span class="line">        _department = department;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 委托函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">getManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _department.getManager();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用</span></span><br><span class="line">Person manager = john.getManager();</span><br></pre></td></tr></table></figure>

<h5 id="Remove-Middle-Man（移除中间人）"><a href="#Remove-Middle-Man（移除中间人）" class="headerlink" title="Remove Middle Man（移除中间人）"></a>Remove Middle Man（移除中间人）</h5><p>让客户直接调用受托类。随着受托类的特性（功能）越来越多，服务类完全变成了一个“中间人”，每当客户要使用受托类的新特性时，就必须在服务端添加一个简单委托函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Remove Middle Man是Hide Delegate的逆过程，源码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Foreign-Method（引入外加函数）"><a href="#Introduce-Foreign-Method（引入外加函数）" class="headerlink" title="Introduce Foreign Method（引入外加函数）"></a>Introduce Foreign Method（引入外加函数）</h5><p>在客户类中建立一个函数，并以第一参数形式传入一个服务类实例。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line">Date newStart = <span class="keyword">new</span> Date(previousEnd.getYear(), previousEnd.getMonth(), </span><br><span class="line">    previousEnd.getDate() + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line">Date newStart = nextDay(previousEnd);</span><br><span class="line"></span><br><span class="line"><span class="comment">// foreign method, should be on date</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Date <span class="title">nextDay</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date(date.getYear(), date.getMonth(), date.getDate() + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Local-Extension（引入本地扩展）"><a href="#Introduce-Local-Extension（引入本地扩展）" class="headerlink" title="Introduce Local Extension（引入本地扩展）"></a>Introduce Local Extension（引入本地扩展）</h5><p>建立一个新类，使它包含这些额外函数。让这个扩展品成为源类的子类或者包装类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line">Date newStart = nextDay(previousEnd);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Date <span class="title">nextDay</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date(date.getYear(), date.getMonth(), date.getDate() + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor with subclass=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SubDate</span> <span class="keyword">extends</span> <span class="title">Date</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 委托父类的构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubDate</span><span class="params">(String dateString)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(dateString);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转型构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SubDate</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(date.getTime());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">nextDay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date(getYear(), getMonth(), getDate() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor with wrap class=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WrapDate</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Date _original;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 构造函数委托给父类</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapDate</span><span class="params">(String dateString)</span> </span>&#123;</span><br><span class="line">        _original = <span class="keyword">new</span> Date(dateString);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 转型构造函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">WrapDate</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">        _original = date;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 为原始类的所有函数提供委托函数</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getYear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _original.getYear();</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Date <span class="title">nextDay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Date(getYear(), getMonth(), getDate() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="重新组织数据"><a href="#重新组织数据" class="headerlink" title="重新组织数据"></a>重新组织数据</h4><h5 id="Self-Encapsulate-Field（自封装字段）"><a href="#Self-Encapsulate-Field（自封装字段）" class="headerlink" title="Self Encapsulate Field（自封装字段）"></a>Self Encapsulate Field（自封装字段）</h5><p>为这个字段建立取值/设值函数，并且只以这些函数来访问字段。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line">privaet <span class="keyword">int</span> _low, _high;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">includes</span> <span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg &gt; _low &amp;&amp; arg &lt; _high;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">int</span> _low, _high;</span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">includes</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> arg &gt; getLow() &amp;&amp; arg &lt; getHigh();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getLow</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _low;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getHigh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _high;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Data-Value-with-Object（以对象取代数据值）"><a href="#Replace-Data-Value-with-Object（以对象取代数据值）" class="headerlink" title="Replace Data Value with Object（以对象取代数据值）"></a>Replace Data Value with Object（以对象取代数据值）</h5><p>将数据项改为对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Order</span>(<span class="title">String</span> <span class="title">customer</span>) </span>&#123;</span><br><span class="line">      _customer = customer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _customer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">      _customer = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String _customer;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String _name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Order</span>(<span class="title">String</span> <span class="title">customer</span>) </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _customer.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Customer _customer;</span><br></pre></td></tr></table></figure>

<h5 id="Change-Value-to-Reference（将值对象改为引用对象）"><a href="#Change-Value-to-Reference（将值对象改为引用对象）" class="headerlink" title="Change Value to Reference（将值对象改为引用对象）"></a>Change Value to Reference（将值对象改为引用对象）</h5><p>将这个值对象变成引用对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String _name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Order</span>(<span class="title">String</span> <span class="title">customer</span>) </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _customer.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Customer _customer;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Directionary _instances = <span class="keyword">new</span> Hashtable();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Customer <span class="title">getNamed</span> <span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (Customer) _instances.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Customer</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String _name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Order</span>(<span class="title">String</span> <span class="title">customer</span>) </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(customer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> _customer.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">      _customer = <span class="keyword">new</span> Customer(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Customer _customer;</span><br></pre></td></tr></table></figure>

<h5 id="Change-Reference-to-Value（将引用对象改为值对象）"><a href="#Change-Reference-to-Value（将引用对象改为值对象）" class="headerlink" title="Change Reference to Value（将引用对象改为值对象）"></a>Change Reference to Value（将引用对象改为值对象）</h5><p>将它变成一个值对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Currency</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">_code</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        _code = code;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Currency</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">_code</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCode</span><span class="params">(String code)</span> </span>&#123;</span><br><span class="line">        _code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!(arg <span class="keyword">instanceof</span> Currency)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Currency other = (Currency) arg;</span><br><span class="line">        <span class="keyword">return</span> _code.equals(other.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 实现hashCode()的简单方法：读取equals()使用的所有字段的hash码，然后对它们进行按位异或(^)操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _code.hashCode();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Array-with-Object（以对象取代数组）"><a href="#Replace-Array-with-Object（以对象取代数组）" class="headerlink" title="Replace Array with Object（以对象取代数组）"></a>Replace Array with Object（以对象取代数组）</h5><p>以对象替代数组。对于数组中的每个元素，以一个字段来表示。(适用于“一个数组容纳了多种不同对象”，而不适用于“以某种顺序容纳一组相似对象”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line">String[] row = <span class="keyword">new</span> String[<span class="number">3</span>];</span><br><span class="line">row[<span class="number">0</span>] = <span class="string">"Liverpool"</span>;</span><br><span class="line">row[<span class="number">1</span>] = <span class="string">"15"</span>;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line">Performance row = <span class="keyword">new</span> Performance();</span><br><span class="line">row.setName(<span class="string">"Liverpool"</span>);</span><br><span class="line">row.setWins(<span class="string">"15"</span>);</span><br></pre></td></tr></table></figure>

<h5 id="Duplicate-Observed-Data（复制“被监视数据”）"><a href="#Duplicate-Observed-Data（复制“被监视数据”）" class="headerlink" title="Duplicate Observed Data（复制“被监视数据”）"></a>Duplicate Observed Data（复制“被监视数据”）</h5><p>将该数据复制到一个领域对象中。建立一个Observer模式，用以同步领域对象和GUI对象内的重复数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 未理解。</span></span><br><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br></pre></td></tr></table></figure>

<h5 id="Change-Unidirectional-Association-to-Bidirectional（将单向关联改为双向关联）"><a href="#Change-Unidirectional-Association-to-Bidirectional（将单向关联改为双向关联）" class="headerlink" title="Change Unidirectional Association to Bidirectional（将单向关联改为双向关联）"></a>Change Unidirectional Association to Bidirectional（将单向关联改为双向关联）</h5><p>添加一个反向指针，并使修改函数能够同时更新两条连接。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Customer</span> <span class="title">getCustomer</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _customer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer arg)</span> </span>&#123;</span><br><span class="line">        _customer = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Customer _customer;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Customer</span> <span class="title">getCustomer</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _customer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCustomer</span><span class="params">(Customer arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(_customer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            _customer.friendOrders().remove(<span class="keyword">this</span>);</span><br><span class="line">            _customer = arg;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (_customer != <span class="keyword">null</span>) &#123;</span><br><span class="line">            _customer.friendOrders().add(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Customer _customer;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">Set</span> <span class="title">_orders</span> </span>= <span class="keyword">new</span> HashSet();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addOrder</span><span class="params">(Order arg)</span> </span>&#123;</span><br><span class="line">        arg.setCustomer(<span class="keyword">this</span>);</span><br><span class="line">        _order.add(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set <span class="title">friendOrders</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">/* should only be used by other */</span></span><br><span class="line">        <span class="keyword">return</span> _orders;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Change-Bidirectional-Association-to-Unidirectional（将双向关联改为单向关联）"><a href="#Change-Bidirectional-Association-to-Unidirectional（将双向关联改为单向关联）" class="headerlink" title="Change Bidirectional Association to Unidirectional（将双向关联改为单向关联）"></a>Change Bidirectional Association to Unidirectional（将双向关联改为单向关联）</h5><p>去除不必要的关联。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Change Unidirectional Association to Bidirectional的逆过程，代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Replace-Magic-Number-with-symbolic-Constant（以字面常量取代魔法数）"><a href="#Replace-Magic-Number-with-symbolic-Constant（以字面常量取代魔法数）" class="headerlink" title="Replace Magic Number with symbolic Constant（以字面常量取代魔法数）"></a>Replace Magic Number with symbolic Constant（以字面常量取代魔法数）</h5><p>创造一个常量，根据其意义为它命名，并将上述的字面数值替换为这个常量。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">potentialEnergy</span><span class="params">(<span class="keyword">double</span> mass, <span class="keyword">double</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mass * <span class="number">9.81</span> * height;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">potentialEnergy</span><span class="params">(<span class="keyword">double</span> mass, <span class="keyword">double</span> height)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> mass * GRAVITATIONAL_CONSTANT * height;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">double</span> GRAVITATIONAL_CONSTANT = <span class="number">9.81</span>;</span><br></pre></td></tr></table></figure>

<h5 id="Encapsulate-Field（封装字段）"><a href="#Encapsulate-Field（封装字段）" class="headerlink" title="Encapsulate Field（封装字段）"></a>Encapsulate Field（封装字段）</h5><p>将它声明为private，并提供相应的访问函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">public</span> String _name;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">private</span> String _name;</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _name;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> voif <span class="title">setName</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">    _name = arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Encapsulate-Collection（封装集合）"><a href="#Encapsulate-Collection（封装集合）" class="headerlink" title="Encapsulate Collection（封装集合）"></a>Encapsulate Collection（封装集合）</h5><p>让这个函数返回该集合的一个只读副本，并在这个类中提供添加/移除集合元素的函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set _courses;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set <span class="title">getCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _courses;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCourses</span><span class="params">(Set courses)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>._courses = courses;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Set _courses;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initCourses</span><span class="params">(Set arg)</span> </span>&#123;</span><br><span class="line">        Assert.isTrue(_courses.isEmpty());</span><br><span class="line">        _courses.addAll(arg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCourse</span><span class="params">(Course course)</span> </span>&#123;</span><br><span class="line">        _courses.add(course);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeCourse</span><span class="params">(Course course)</span> </span>&#123;</span><br><span class="line">        _courses.remove(course);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">numberOfCourses</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _courses.size();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Record-with-Data-Class（以数据类取代记录）"><a href="#Replace-Record-with-Data-Class（以数据类取代记录）" class="headerlink" title="Replace Record with Data Class（以数据类取代记录）"></a>Replace Record with Data Class（以数据类取代记录）</h5><p>为该记录创建一个“哑”数据对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 新建一个类，建立private字段，并提供相应的取值/设值函数。代码略。*/</span></span><br></pre></td></tr></table></figure>

<h5 id="Replace-Type-Code-with-Class（以类取代类型码）"><a href="#Replace-Type-Code-with-Class（以类取代类型码）" class="headerlink" title="Replace Type Code with Class（以类取代类型码）"></a>Replace Type Code with Class（以类取代类型码）</h5><p>以一个新的类替换该数值类的类型码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> O = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> A = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> B = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> AB = <span class="number">3</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _bloodGroup;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(<span class="keyword">int</span> bloodGroup)</span> </span>&#123;</span><br><span class="line">        _bloodGroup = bloodGroup;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBloodGroup</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">        _bloodGroup = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getBloodGroup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _bloodGroup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BloodGroup</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BloodGroup O = <span class="keyword">new</span> BloodGroup(<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BloodGroup A = <span class="keyword">new</span> BloodGroup(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BloodGroup B = <span class="keyword">new</span> BloodGroup(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> BloodGroup AB = <span class="keyword">new</span> BloodGroup(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BloodGroup[] _values = &#123;O, A, B, AB&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> _code;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BloodGroup</span><span class="params">(<span class="keyword">int</span> code)</span> </span>&#123;</span><br><span class="line">        _code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BloodGroup <span class="title">code</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _values[arg];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BloodGroup _bloodGroup;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(BloodGroup bloodGroup)</span> </span>&#123;</span><br><span class="line">        _bloodGroup = bloodGroup;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBloodGroup</span><span class="params">(BloodGroup arg)</span> </span>&#123;</span><br><span class="line">        _bloodGroup = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> BloodGroup <span class="title">getBloodGroup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _bloodGroup;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Type-Code-with-Subclasses（以子类取代类型码）"><a href="#Replace-Type-Code-with-Subclasses（以子类取代类型码）" class="headerlink" title="Replace Type Code with Subclasses（以子类取代类型码）"></a>Replace Type Code with Subclasses（以子类取代类型码）</h5><p>以子类取代类型码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">int</span> <span class="title">_type</span></span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENGINEER = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SALESMAN = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MANAGER = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    Employee(<span class="keyword">int</span> type) &#123;</span><br><span class="line">        _type = type;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">int</span> <span class="title">_type</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Employee <span class="title">create</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">            <span class="keyword">case</span> ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Engineer();</span><br><span class="line">            <span class="keyword">case</span> SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Salesman();</span><br><span class="line">            <span class="keyword">case</span> MANAGER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Manager();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Incorrect type code value"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Employee</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        _type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Engineer.ENGINEER;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Type-Code-with-State-Strategy（以State-Strategy取代类型码）"><a href="#Replace-Type-Code-with-State-Strategy（以State-Strategy取代类型码）" class="headerlink" title="Replace Type Code with State/Strategy（以State/Strategy取代类型码）"></a>Replace Type Code with State/Strategy（以State/Strategy取代类型码）</h5><p>以状态对象取代类型码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">int</span> <span class="title">_type</span></span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENGINEER = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SALESMAN = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MANAGER = <span class="number">2</span>;</span><br><span class="line">    </span><br><span class="line">    Employee(<span class="keyword">int</span> type) &#123;</span><br><span class="line">        _type = type;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">payAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(_type) &#123;</span><br><span class="line">            <span class="keyword">case</span> ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary;</span><br><span class="line">            <span class="keyword">case</span> SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _commission;</span><br><span class="line">            <span class="keyword">case</span> MANAGER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _bonus;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Incorrect Employee"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">EmployeeType</span> <span class="title">_type</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setType</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">        _type = EmployeeType.newType(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _type.getTypeCode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">payAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _commission;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.MANAGER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _bonus;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Incorrect Employee"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeType</span>...</span></span><br><span class="line"><span class="class">    <span class="title">abstract</span> <span class="title">int</span> <span class="title">getTypeCode</span>()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> EmployeeType <span class="title">newType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">            <span class="keyword">case</span> ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Engineer();</span><br><span class="line">            <span class="keyword">case</span> SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Salesman();</span><br><span class="line">            <span class="keyword">case</span> MANAGER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Manager();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Incorrect type code value"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENGINEER = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SALESMAN = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MANAGER = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">EmployeeType</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getTypeCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Employee.ENGINEER;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Subclass-with-Field（以字段取代子类）"><a href="#Replace-Subclass-with-Field（以字段取代子类）" class="headerlink" title="Replace Subclass with Field（以字段取代子类）"></a>Replace Subclass with Field（以字段取代子类）</h5><p>修改这些函数，使他们返回超类中的某个（新增）字段，然后销毁子类。（适用于子类中只有常量函数，这些函数只返回硬编码的值）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">boolean</span> <span class="title">isMale</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">char</span> <span class="title">getCode</span><span class="params">()</span></span>;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Male</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isMale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">char</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'M'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Female</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isMale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">char</span> <span class="title">getCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'F'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Person <span class="title">createMale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Person(<span class="keyword">true</span>, <span class="string">'M'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Person <span class="title">createFemale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Person(<span class="keyword">false</span>, <span class="string">'F'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">Person</span><span class="params">(<span class="keyword">boolean</span> isMale, <span class="keyword">char</span> code)</span> </span>&#123;</span><br><span class="line">        _isMale = isMale;</span><br><span class="line">        _code = code;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> _isMale;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">char</span> _code;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="简化条件表达式"><a href="#简化条件表达式" class="headerlink" title="简化条件表达式"></a>简化条件表达式</h4><h5 id="Decompose-Conditional（分解条件表达式）"><a href="#Decompose-Conditional（分解条件表达式）" class="headerlink" title="Decompose Conditional（分解条件表达式）"></a>Decompose Conditional（分解条件表达式）</h5><p>从if、then、else三个段落中分别提炼出独立函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">if</span> (date.before(SUMMER_START) || data.after(SUMMER_END)) &#123;</span><br><span class="line">    charge = quantity * _winterRate + _winterServiceCharge;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    charge = quantity * _summerRate;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">if</span> (notSummer(date)) &#123;</span><br><span class="line">    charge = winterCharge(quantity);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    charge = summerCharge(quantity);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">notSummer</span><span class="params">(Date date)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> date.before(SUMMER_START) || date.after(SUMMER_END);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">winterCharge</span><span class="params">(<span class="keyword">int</span> quantity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> quantity * _winterRate + _winterServiceCharge;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">summerCharge</span><span class="params">(<span class="keyword">int</span> quantity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> quantity * _summerRate;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Consolidate-Conditional-Expression（合并条件表达式）"><a href="#Consolidate-Conditional-Expression（合并条件表达式）" class="headerlink" title="Consolidate Conditional Expression（合并条件表达式）"></a>Consolidate Conditional Expression（合并条件表达式）</h5><p>将这些测试合并为一个条件表达式，并将这个条件表达式提炼成为一个独立函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">disabilityAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_seniority &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (_monthsDisabled &gt; <span class="number">12</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (_isPartTime) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// compute the disability amount</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">disabilityAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (isNotEligibleForDisability()) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// compute the disability amount</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isNotEligibleForDisability</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> ((_seniority &lt; <span class="number">2</span>) || (_monthsDisabled &gt; <span class="number">12</span>) || (_isPartTime));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Consolidate-Duplicate-Conditional-Fragments（合并重复的条件片段）"><a href="#Consolidate-Duplicate-Conditional-Fragments（合并重复的条件片段）" class="headerlink" title="Consolidate Duplicate Conditional Fragments（合并重复的条件片段）"></a>Consolidate Duplicate Conditional Fragments（合并重复的条件片段）</h5><p>将这段重复代码搬移到条件表达式之外。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="keyword">if</span> (isSpecialDeal()) &#123;</span><br><span class="line">    total = price * <span class="number">0.95</span>;</span><br><span class="line">    send();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    total = price * <span class="number">0.98</span>;</span><br><span class="line">    send();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">if</span> (isSpecialDeal()) &#123;</span><br><span class="line">    total = price * <span class="number">0.95</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    total = price * <span class="number">0.98</span>;</span><br><span class="line">&#125;</span><br><span class="line">send();</span><br></pre></td></tr></table></figure>

<h5 id="Remove-Control-Flag（移除控制标记）"><a href="#Remove-Control-Flag（移除控制标记）" class="headerlink" title="Remove Control Flag（移除控制标记）"></a>Remove Control Flag（移除控制标记）</h5><p>以break语句或return语句取代控制标记。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundMiscreant</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    String found = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!found) &#123;</span><br><span class="line">            <span class="keyword">if</span> (people[i].equals(<span class="string">"Don"</span>)) &#123;</span><br><span class="line">                sendAlert();</span><br><span class="line">                found = <span class="string">"Don"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (people[i].equals(<span class="string">"John"</span>)) &#123;</span><br><span class="line">                sendAlert();</span><br><span class="line">                found = <span class="string">"John"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> found;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundMiscreant</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"Don"</span>)) &#123;</span><br><span class="line">            sendAlert();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Don"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"John"</span>)) &#123;</span><br><span class="line">            sendAlert();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"John"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Nested-Confitional-with-Guard-Clauses（以卫语句取代嵌套条件表达式）"><a href="#Replace-Nested-Confitional-with-Guard-Clauses（以卫语句取代嵌套条件表达式）" class="headerlink" title="Replace Nested Confitional with Guard Clauses（以卫语句取代嵌套条件表达式）"></a>Replace Nested Confitional with Guard Clauses（以卫语句取代嵌套条件表达式）</h5><p>使用卫语句表现所有特殊情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="comment">// 示例1：</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getPayAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result;</span><br><span class="line">    <span class="keyword">if</span> (_isDead) result = deadAmount();</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (_isSeparated) result = seperatedAmount();</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (_isRetired) result = retiredAmount();</span><br><span class="line">            <span class="keyword">else</span> result = normalPayAmount();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 示例2:</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getAdjustedCapital</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result = <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (_capital &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (_intRate &gt; <span class="number">0.0</span> &amp;&amp; _duration &gt; <span class="number">0.0</span>) &#123;</span><br><span class="line">            result = (_income / _duration) * ADJ_FACTOR;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="comment">// 示例1：</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getPayAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_isDead) <span class="keyword">return</span> deadAmount();</span><br><span class="line">    <span class="keyword">if</span> (_isSeparated) <span class="keyword">return</span> seperatedAmount();</span><br><span class="line">    <span class="keyword">if</span> (_isRetired) <span class="keyword">return</span> retiredAmount();</span><br><span class="line">    <span class="keyword">return</span> normalPayAmount();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 示例2（条件表达式反转）：</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getAdjustedCapital</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_capital &lt;= <span class="number">0.0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">if</span> (_intRate &lt;= <span class="number">0.0</span> || _duration &lt;= <span class="number">0.0</span>) <span class="keyword">return</span> <span class="number">0.0</span>;</span><br><span class="line">    <span class="keyword">return</span> (_income / _duration) * ADJ_FACTOR;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Conditional-with-Polymorphism（以多态取代条件表达式）"><a href="#Replace-Conditional-with-Polymorphism（以多态取代条件表达式）" class="headerlink" title="Replace Conditional with Polymorphism（以多态取代条件表达式）"></a>Replace Conditional with Polymorphism（以多态取代条件表达式）</h5><p>将这个条件表达式的每个分支放进一个子类内的复写函数中，然后将原始函数声明为抽象函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">EmployeeType</span> <span class="title">_type</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setType</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">        _type = EmployeeType.newType(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _type.getTypeCode();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">payAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(getType()) &#123;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _commission;</span><br><span class="line">            <span class="keyword">case</span> EmployeeType.MANAGER:</span><br><span class="line">                <span class="keyword">return</span> _monthlySalary + _bonus;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Incorrect Employee"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeType</span>...</span></span><br><span class="line"><span class="class">    <span class="title">abstract</span> <span class="title">int</span> <span class="title">getTypeCode</span>()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">static</span> EmployeeType <span class="title">newType</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span>(type) &#123;</span><br><span class="line">            <span class="keyword">case</span> ENGINEER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Engineer();</span><br><span class="line">            <span class="keyword">case</span> SALESMAN:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Salesman();</span><br><span class="line">            <span class="keyword">case</span> MANAGER:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Manager();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Incorrect type code value"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> ENGINEER = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> SALESMAN = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MANAGER = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">EmployeeType</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getTypeCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Employee.ENGINEER;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">EmployeeType</span> <span class="title">_type</span></span>;</span><br><span class="line">    </span><br><span class="line">    Employee(EmployeeType arg) &#123;</span><br><span class="line">        _type = arg.newType();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">payAmount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _type.payAmount(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">EmployeeType</span>...</span></span><br><span class="line"><span class="class">    <span class="title">abstract</span> <span class="title">EmployeeType</span> <span class="title">newType</span>()</span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">payAmount</span><span class="params">(Employee emp)</span></span>;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Engineer</span> <span class="keyword">extends</span> <span class="title">EmployeeType</span> </span>&#123;</span><br><span class="line">    <span class="function">EmployeeType <span class="title">newType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Engineer();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">payAmount</span><span class="params">(Employee emp)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> emp.getMonthlySalary();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">...Other Subclass implemention</span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Null-Object（引入Null对象）"><a href="#Introduce-Null-Object（引入Null对象）" class="headerlink" title="Introduce Null Object（引入Null对象）"></a>Introduce Null Object（引入Null对象）</h5><p>将null值替换为null对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Site</span>...</span></span><br><span class="line"><span class="class">    <span class="title">Customer</span> <span class="title">_customer</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Cumsomer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _customer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">getName</span>() </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BillingPlan <span class="title">getPlan</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaymentHistory <span class="title">getHistory</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用代码片段</span></span><br><span class="line">    Customer customer = site.getCustomer();</span><br><span class="line">    BillingPlan plan;</span><br><span class="line">    <span class="keyword">if</span> (customer == <span class="keyword">null</span>) plan = BillingPlan.basic();</span><br><span class="line">    <span class="keyword">else</span> plan = customer.getPlan();</span><br><span class="line">...</span><br><span class="line">    String customerName;</span><br><span class="line">    <span class="keyword">if</span> (customer == <span class="keyword">null</span>) customerName = <span class="string">"occupant"</span>;</span><br><span class="line">    <span class="keyword">else</span> customerName = customer.getName();</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">int</span> weeksDelinquent;</span><br><span class="line">    <span class="keyword">if</span> (customer == <span class="keyword">null</span>) weekDeliquent = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> weekDelinquent = customer.getHistory.getWeekDelinquentInLastYear();</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Site</span>...</span></span><br><span class="line"><span class="class">    <span class="title">Customer</span> <span class="title">_customer</span></span>;</span><br><span class="line">    </span><br><span class="line">    <span class="function">Cumsomer <span class="title">getCustomer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (_customer == <span class="keyword">null</span>) ? Customer.newNull() : _customer;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">static</span> <span class="title">Customer</span> <span class="title">newNull</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> NullCustomer();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BillingPlan <span class="title">getPlan</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaymentHistory <span class="title">getHistory</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"occupant"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> BillingPlan <span class="title">getPlan</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BillingPlan.basic();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> PaymentHistory <span class="title">getHistory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PaymentHistory.newNull();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NullPaymentHistory</span> <span class="keyword">extends</span> <span class="title">PaymentHistory</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getWeekDelinquentInLastYear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用代码片段</span></span><br><span class="line">    Customer customer = site.getCustomer();</span><br><span class="line">    BillingPlan plan = customer.getPlan();</span><br><span class="line">...</span><br><span class="line">    String customerName = customer.getName();</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">int</span> weeksDelinquent = customer.getHistory.getWeekDelinquentInLastYear();</span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Assertion（引入断言）"><a href="#Introduce-Assertion（引入断言）" class="headerlink" title="Introduce Assertion（引入断言）"></a>Introduce Assertion（引入断言）</h5><p>以断言明确表现这种假设。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getExpenseLimit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// should have either expense limit or a primary project</span></span><br><span class="line">    <span class="keyword">return</span> (expenseLimit != NULL_EXPENSE) ? </span><br><span class="line">        _expenseLimit : _primaryProject.getMemberExpenseLimit();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">getExpenseLimit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Assert.isTrue(expenseLimit != NULL_EXPENSE || _primaryProject != <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">return</span> (expenseLimit != NULL_EXPENSE) ? </span><br><span class="line">        _expenseLimit : _primaryProject.getMemberExpenseLimit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="简化函数调用"><a href="#简化函数调用" class="headerlink" title="简化函数调用"></a>简化函数调用</h4><h5 id="Rename-Method（函数改名）"><a href="#Rename-Method（函数改名）" class="headerlink" title="Rename Method（函数改名）"></a>Rename Method（函数改名）</h5><p>函数的名称未能揭示函数的用途，修改函数名称。首先考虑应该给这个函数写上一句怎样的注释，然后想办法将注释变成函数名称。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Add-Parameter（添加参数）"><a href="#Add-Parameter（添加参数）" class="headerlink" title="Add Parameter（添加参数）"></a>Add Parameter（添加参数）</h5><p>某个函数需要从调用端得到更多信息，为此函数添加一个对象参数，让该对象带进函数所需信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Remove-Parameter（移除参数）"><a href="#Remove-Parameter（移除参数）" class="headerlink" title="Remove Parameter（移除参数）"></a>Remove Parameter（移除参数）</h5><p>函数本体不再需要某个参数，将该参数去除。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Separate-Query-from-Modifier（将查询函数和修改函数分离）"><a href="#Separate-Query-from-Modifier（将查询函数和修改函数分离）" class="headerlink" title="Separate Query from Modifier（将查询函数和修改函数分离）"></a>Separate Query from Modifier（将查询函数和修改函数分离）</h5><p>某个函数既返回对象状态值，又修改对象状态。建立两个不同的函数，其中一个负责查询，另一个负责修改。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundMiscreant</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"Don"</span>)) &#123;</span><br><span class="line">            sendAlert();</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Don"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"John"</span>)) &#123;</span><br><span class="line">            sendAlert();</span><br><span class="line">            retuurn <span class="string">"John"</span>；</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkSecurity</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    String found = foundMiscreant(people);</span><br><span class="line">    someLaterCode(found);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function">String <span class="title">foundPeople</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; people.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"Don"</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Don"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (people[i].equals(<span class="string">"John"</span>)) &#123;</span><br><span class="line">            retuurn <span class="string">"John"</span>；</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">checkSecurity</span><span class="params">(String[] people)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!foundPeople(people).equals(<span class="string">""</span>)) &#123;</span><br><span class="line">        sendAlert();</span><br><span class="line">    &#125;</span><br><span class="line">    someLaterCode(found);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Parameterize-Method（令函数携带参数）"><a href="#Parameterize-Method（令函数携带参数）" class="headerlink" title="Parameterize Method（令函数携带参数）"></a>Parameterize Method（令函数携带参数）</h5><p>若干函数做了类似的工作，但在函数本体中却包含了不同的值。建立单一函数，以参数表达那些不同的值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Dollars <span class="title">baseCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result = Math.min(lastUsage(), <span class="number">100</span>) * <span class="number">0.03</span>;</span><br><span class="line">    <span class="keyword">if</span> (lastUsage() &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        result += (Math.min(lastUsage(), <span class="number">200</span>) - <span class="number">100</span>) * <span class="number">0.05</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lastUsage() &gt; <span class="number">200</span>) &#123;</span><br><span class="line">        result += (lastUsage() - <span class="number">200</span>) * <span class="number">0.07</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Dollars(result);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> Dollars <span class="title">baseCharge</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> result = usageInRange(<span class="number">0</span>, <span class="number">100</span>) * <span class="number">0.03</span>;</span><br><span class="line">    result += usageInRange(<span class="number">100</span>, <span class="number">200</span>) * <span class="number">0.05</span>;</span><br><span class="line">    result += usageInRange(<span class="number">200</span>, Integer.MAX_VALUE) * <span class="number">0.07</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Dollars(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">usageInRange</span><span class="params">(<span class="keyword">int</span> start, <span class="keyword">int</span> end)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lastUsage() &gt; start) &#123;</span><br><span class="line">        <span class="keyword">return</span> Math.min(lastUsage(), end) - start;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Parameter-with-Explicit-Methods（以明确函数取代参数）"><a href="#Replace-Parameter-with-Explicit-Methods（以明确函数取代参数）" class="headerlink" title="Replace Parameter with Explicit Methods（以明确函数取代参数）"></a>Replace Parameter with Explicit Methods（以明确函数取代参数）</h5><p>有一个函数，其中完全取决于参数值而采取不同行为。针对该参数的每一个可能值，建立一个独立函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String name, <span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">"height"</span>)) &#123;</span><br><span class="line">        _height = value;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (name.equals(<span class="string">"width"</span>)) &#123;</span><br><span class="line">        _width = value;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Assert.shouldNeverreachHere();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    _height = arg;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123;</span><br><span class="line">    _width = arg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Preserve-Whole-object（保持对象完整）"><a href="#Preserve-Whole-object（保持对象完整）" class="headerlink" title="Preserve Whole object（保持对象完整）"></a>Preserve Whole object（保持对象完整）</h5><p>从某个对象中取出若干值，将它们作为某一次函数调用时的参数。改为传递整个对象。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span>...</span></span><br><span class="line"><span class="class">    <span class="title">boolean</span> <span class="title">withinPlan</span>(<span class="title">HeatingPlan</span> <span class="title">plan</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> low = daysTempRange().getLow();</span><br><span class="line">        <span class="keyword">int</span> high = daysTempRange().getHigh()</span><br><span class="line">        <span class="keyword">return</span> plan.witninRange(daysTempRange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeatingPlan</span>...</span></span><br><span class="line"><span class="class">    <span class="title">boolean</span> <span class="title">withinRange</span>(<span class="title">int</span> <span class="title">low</span>, <span class="title">int</span> <span class="title">high</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (low &gt;= _range.getLow() &amp;&amp; high &lt;= _range.getHigh());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TempRange _range;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span>...</span></span><br><span class="line"><span class="class">    <span class="title">boolean</span> <span class="title">withinPlan</span>(<span class="title">HeatingPlan</span> <span class="title">plan</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> plan.witninRange(daysTempRange());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HeatingPlan</span>...</span></span><br><span class="line"><span class="class">    <span class="title">boolean</span> <span class="title">withinRange</span>(<span class="title">TempRange</span> <span class="title">roomRange</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _range.includes(roomRange);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> TempRange _range;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TempRange</span>...</span></span><br><span class="line"><span class="class">    <span class="title">boolean</span> <span class="title">includes</span>(<span class="title">TempRange</span> <span class="title">arg</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.getLow() &gt;= <span class="keyword">this</span>.getLow() &amp;&amp;</span><br><span class="line">            arg.getHigh() &lt;= <span class="keyword">this</span>.getHigh();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Parameter-with-Methods（以函数取代参数）"><a href="#Replace-Parameter-with-Methods（以函数取代参数）" class="headerlink" title="Replace Parameter with Methods（以函数取代参数）"></a>Replace Parameter with Methods（以函数取代参数）</h5><p>对象调用某个函数，并将所得结果作为参数，传递给另一个函数，而接受该参数的函数本身也能够调用前一个函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> basePrice = _quantity * _itemPrice;</span><br><span class="line">    <span class="keyword">int</span> discountLevel;</span><br><span class="line">    <span class="keyword">if</span> (_quantity &gt; <span class="number">100</span>) discountLevel = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> discountLevel = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">double</span> finalPrice = discountedPrice(baselinePrice, discountLevel);</span><br><span class="line">    <span class="keyword">return</span> finalPrice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">discountedPrice</span><span class="params">(<span class="keyword">int</span> basePrice, <span class="keyword">int</span> discountLevel)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (discountLevel == <span class="number">2</span>) <span class="keyword">return</span> basePrice * <span class="number">0.1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> basePrice * <span class="number">0.05</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">getPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (getDiscountLevel == <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> getBasePrice() * <span class="number">0.1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> getBasePrice() * <span class="number">0.05</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">double</span> <span class="title">getBasePrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> _quantity * _itemPrice;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">getDiscountLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (_quantity &gt; <span class="number">100</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Introduce-Parameter-Object（引入参数对象）"><a href="#Introduce-Parameter-Object（引入参数对象）" class="headerlink" title="Introduce Parameter Object（引入参数对象）"></a>Introduce Parameter Object（引入参数对象）</h5><p>某些参数总是很自然地同时出现，以一个对象取代这些参数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">double</span> <span class="title">getFlowBetween</span>(<span class="title">Date</span> <span class="title">start</span>, <span class="title">Date</span> <span class="title">end</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">        Enumeration e = _entries.elements();</span><br><span class="line">        <span class="keyword">while</span> (e.hasMoreElements()) &#123;</span><br><span class="line">            Entry each = (Entry) e.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (each.getDate().equals(start) || each.getDate().equals(end) || </span><br><span class="line">            (each.getDate().after(start) &amp;&amp; each.getDate().before(end))) &#123;</span><br><span class="line">                result += each.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">client code...</span><br><span class="line">    <span class="keyword">double</span> flow = anAccount.getFlowBetween(startDate, endDate);</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">double</span> <span class="title">getFlowBetween</span>(<span class="title">DateRange</span> <span class="title">range</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> result = <span class="number">0</span>;</span><br><span class="line">        Enumeration e = _entries.elements();</span><br><span class="line">        <span class="keyword">while</span> (e.hasMoreElements()) &#123;</span><br><span class="line">            Entry each = (Entry) e.nextElement();</span><br><span class="line">            <span class="keyword">if</span> (range.includes(each.getDate()) &#123;</span><br><span class="line">                result += each.getValue();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DateRange</span> </span>&#123;</span><br><span class="line">    DateRange(Date start, Date end) &#123;</span><br><span class="line">        _start = start;</span><br><span class="line">        _end = end;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">includes</span><span class="params">(Date arg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> arg.equals(_start) || arg.equals(_end) ||</span><br><span class="line">            arg.after(_start) &amp;&amp; arg.before(_end))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Date _start;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Date _end;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">client code...</span><br><span class="line">    <span class="keyword">double</span> flow = anAccount.getFlowBetween(<span class="keyword">new</span> DateRange(startDate, endDate));</span><br></pre></td></tr></table></figure>

<h5 id="Remove-Setting-Method（移除设值函数）"><a href="#Remove-Setting-Method（移除设值函数）" class="headerlink" title="Remove Setting Method（移除设值函数）"></a>Remove Setting Method（移除设值函数）</h5><p>类中的某个字段应该在对象创建时被设值，然后就不再改变。去掉该字段的所有设值函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String _id;</span><br><span class="line">    </span><br><span class="line">    Account(String id) &#123;</span><br><span class="line">        setId(id);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setId</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        _id = arg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String _id;</span><br><span class="line">    </span><br><span class="line">    Account(String id) &#123;</span><br><span class="line">        _id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InterestAccount</span> <span class="keyword">extends</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">double</span> <span class="title">_interestRate</span></span>;</span><br><span class="line">    </span><br><span class="line">    InterestAccount(String id, <span class="keyword">double</span> rate) &#123;</span><br><span class="line">        <span class="keyword">super</span>(id);</span><br><span class="line">        _interestRate = rate;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Hide-Method（隐藏函数）"><a href="#Hide-Method（隐藏函数）" class="headerlink" title="Hide Method（隐藏函数）"></a>Hide Method（隐藏函数）</h5><p>有一个函数，从来没有被其他任何类用到，将这个函数修改为private。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Replace-Constructor-with-Factory-Method（以工厂函数取代构造函数）"><a href="#Replace-Constructor-with-Factory-Method（以工厂函数取代构造函数）" class="headerlink" title="Replace Constructor with Factory Method（以工厂函数取代构造函数）"></a>Replace Constructor with Factory Method（以工厂函数取代构造函数）</h5><p>你希望在创建对象时不仅仅是做简单的建构动作，将构造函数替换为工厂函数。该重构手法最显而易见的动机是：在派生子类的过程中以工厂函数取代类型码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>...</span></span><br><span class="line"><span class="class">    <span class="title">Person</span> (<span class="title">int</span> <span class="title">type</span>) </span>&#123;</span><br><span class="line">        _type = type;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span>...</span></span><br><span class="line"><span class="class">    <span class="title">static</span> <span class="title">Person</span> <span class="title">createMale</span>() </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Male();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> Person <span class="title">createFemale</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Female();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">Person kent = Person.createMale();</span><br></pre></td></tr></table></figure>

<h5 id="Encapsulate-Downcast（封装向下转型）"><a href="#Encapsulate-Downcast（封装向下转型）" class="headerlink" title="Encapsulate Downcast（封装向下转型）"></a>Encapsulate Downcast（封装向下转型）</h5><p>某个函数返回的对象，需要由函数调用者执行向下转型（downcast）。将向下转型动作移到函数中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="function">Object <span class="title">lastReading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> readings.lastElement();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="function">Reading <span class="title">lastReading</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (Reading) readings.lastElement();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Error-Code-with-Exception（以异常取代错误码）"><a href="#Replace-Error-Code-with-Exception（以异常取代错误码）" class="headerlink" title="Replace Error Code with Exception（以异常取代错误码）"></a>Replace Error Code with Exception（以异常取代错误码）</h5><p>某个函数返回一个特定的代码，用以表示某种错误情况。改用异常。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">int</span> <span class="title">withdraw</span>(<span class="title">int</span> <span class="title">amount</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (amount &gt; _balance) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            _balance -= amount;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="comment">/* 非检查异常 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">withdraw</span>(<span class="title">int</span> <span class="title">amount</span>) </span>&#123;</span><br><span class="line">        Assert.isTrue(<span class="string">"sufficient funds"</span>, amount &lt;= _balance);</span><br><span class="line">        _balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Assert</span>...</span></span><br><span class="line"><span class="class">    <span class="title">static</span> <span class="title">void</span> <span class="title">isTrue</span>(<span class="title">String</span> <span class="title">comment</span>, <span class="title">bollean</span> <span class="title">test</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!test) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Runtimeexception(<span class="string">"Assertion failed:"</span> + comment);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 受检异常 */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BalanceException</span> <span class="keyword">extends</span> <span class="title">Exception</span> </span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Account</span>...</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">withdraw</span>(<span class="title">int</span> <span class="title">amount</span>) <span class="title">throws</span> <span class="title">BalanceException</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (amount &gt; _balance) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BalanceException();</span><br><span class="line">        &#125;</span><br><span class="line">        _balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端调用</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    account.withdraw(amount);</span><br><span class="line">    doTheUsualThing();</span><br><span class="line">&#125; <span class="keyword">catch</span> (BalanceException e) &#123;</span><br><span class="line">    handleOverdrawn();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Exception-with-Test（以测试取代异常）"><a href="#Replace-Exception-with-Test（以测试取代异常）" class="headerlink" title="Replace Exception with Test（以测试取代异常）"></a>Replace Exception with Test（以测试取代异常）</h5><p>面对一个调用者可以预先检查的条件，你抛出了一个异常。修改调用者，使它在调用函数之前先做检查。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResourcePool</span>...</span></span><br><span class="line"><span class="class">    <span class="title">Resource</span> <span class="title">getResource</span>() </span>&#123;</span><br><span class="line">        Resource result;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = (Resource) _available.pop();</span><br><span class="line">            _allocated.push(result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (EmptyStackException e) &#123;</span><br><span class="line">            result = <span class="keyword">new</span> Resource();</span><br><span class="line">            _allocated.push(result);</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ResourcePool</span>...</span></span><br><span class="line"><span class="class">    <span class="title">Resource</span> <span class="title">getResource</span>() </span>&#123;</span><br><span class="line">        Resource result;</span><br><span class="line">        <span class="keyword">if</span> (_available.isEmpty()) &#123;</span><br><span class="line">            result = <span class="keyword">new</span> Resource();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            result = (Resource) _available.pop();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        _allocated.push(result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="处理概括关系"><a href="#处理概括关系" class="headerlink" title="处理概括关系"></a>处理概括关系</h4><h5 id="Pull-Up-Field（字段上移）"><a href="#Pull-Up-Field（字段上移）" class="headerlink" title="Pull Up Field（字段上移）"></a>Pull Up Field（字段上移）</h5><p>两个子类拥有相同的字段，将该字段移至超类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Pull-Up-Method（函数上移）"><a href="#Pull-Up-Method（函数上移）" class="headerlink" title="Pull Up Method（函数上移）"></a>Pull Up Method（函数上移）</h5><p>有些函数在各个子类中产生完全相同的结果。将该函数移至超类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">RegularCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">createBill</span>(<span class="title">Date</span> <span class="title">date</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> chargeAmount = chargeFor(lastBillDate, date);</span><br><span class="line">        addBill(date, charge);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PreferredCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">createBill</span>(<span class="title">Date</span> <span class="title">date</span>) </span>&#123;...&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">void</span> <span class="title">createBill</span>(<span class="title">Date</span> <span class="title">date</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">double</span> chargeAmount = chargeFor(lastBillDate , date);</span><br><span class="line">        addBill(date, charge);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">double</span> <span class="title">chargeFor</span><span class="params">(Date start, Date end)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegularCustomer</span> <span class="keyword">extends</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">double</span> <span class="title">chargeFor</span>(<span class="title">Date</span> <span class="title">start</span>, <span class="title">Date</span> <span class="title">end</span>) </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Pull-Up-Constructor-Body（构造函数本体上移）"><a href="#Pull-Up-Constructor-Body（构造函数本体上移）" class="headerlink" title="Pull Up Constructor Body（构造函数本体上移）"></a>Pull Up Constructor Body（构造函数本体上移）</h5><p>在各个子类中拥有一些构造函数，它们的本体几乎完全一致。在超类中新建一个构造函数，并在子类构造函数中调用它。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Manager</span>(<span class="title">String</span> <span class="title">name</span>, <span class="title">String</span> <span class="title">id</span>, <span class="title">int</span> <span class="title">grade</span>) </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">        _id = id;</span><br><span class="line">        _grade = grade;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">protected</span> <span class="title">Employee</span>(<span class="title">String</span> <span class="title">name</span>, <span class="title">String</span> <span class="title">id</span>) </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">        _id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manager</span> <span class="keyword">extends</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Manager</span>(<span class="title">String</span> <span class="title">name</span>, <span class="title">String</span> <span class="title">id</span>, <span class="title">int</span> <span class="title">grade</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name, id);</span><br><span class="line">        _grade = grade;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Push-Down-Method（函数下移）"><a href="#Push-Down-Method（函数下移）" class="headerlink" title="Push Down Method（函数下移）"></a>Push Down Method（函数下移）</h5><p>超类中的某个函数只与部分（而非全部）子类有关。将这个函数移到相关的那些子类去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Push-Down-Field（字段下移）"><a href="#Push-Down-Field（字段下移）" class="headerlink" title="Push Down Field（字段下移）"></a>Push Down Field（字段下移）</h5><p>超类中的某个字段只被部分（而非全部）子类用到。将这个字段移到需要它的那些子类去。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Extract-Subclass（提炼子类）"><a href="#Extract-Subclass（提炼子类）" class="headerlink" title="Extract Subclass（提炼子类）"></a>Extract Subclass（提炼子类）</h5><p>类中的某些特性只被某些（而非全部）实例用到。新建一个子类，将上面所说的那一部分特性移到子类中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobItem</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">JobItem</span>(<span class="title">int</span> <span class="title">unitPrice</span>, <span class="title">int</span> <span class="title">quantity</span>, <span class="title">boolean</span> <span class="title">isLabor</span>, <span class="title">Employee</span> <span class="title">employee</span>) </span>&#123;</span><br><span class="line">        _unitPrice = unitPrice;</span><br><span class="line">        _quantity = quantity;</span><br><span class="line">        _isLabor = isLabor;</span><br><span class="line">        _employee = employee;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getUnitPrice() * _quantity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUnitPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _isLabor ? _employee.getRate() : _unitPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _unitPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _quantity;</span><br><span class="line">    <span class="keyword">private</span> Employee _employee;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> _isLabor;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Employee</span>(<span class="title">int</span> <span class="title">rate</span>) </span>&#123;</span><br><span class="line">        _rate = rate;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _rate;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">JobItem</span>...</span></span><br><span class="line"><span class="class">    <span class="title">protected</span> <span class="title">JobItem</span>(<span class="title">int</span> <span class="title">unitPrice</span>, <span class="title">int</span> <span class="title">quantity</span>, <span class="title">Employee</span> <span class="title">employee</span>) </span>&#123;</span><br><span class="line">        _unitPrice = unitPrice;</span><br><span class="line">        _quantity = quantity;</span><br><span class="line">        _employee = employee;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTotalPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> getUnitPrice() * _quantity;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUnitPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  _unitPrice;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _unitPrice;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> _quantity;</span><br><span class="line">    <span class="keyword">private</span> Employee _employee;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LaborItem</span> <span class="keyword">extends</span> <span class="title">JobItem</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">LaborItem</span>(<span class="title">int</span> <span class="title">quantity</span>, <span class="title">Employee</span> <span class="title">employee</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="number">0</span>, quantity, employee);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getUnitPrice</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span>  _employee.getRate();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="Extract-Superclass（提炼超类）"><a href="#Extract-Superclass（提炼超类）" class="headerlink" title="Extract Superclass（提炼超类）"></a>Extract Superclass（提炼超类）</h5><p>两个雷有相似特性，为这两个类建立一个超类，将相同特性移至超类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getTotalAnnualCost</span>() </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeadCount</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getAnnualCost</span>() </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Party</span>...</span></span><br><span class="line"><span class="class">    <span class="title">protected</span> <span class="title">Party</span>(<span class="title">String</span> <span class="title">name</span>) </span>&#123;</span><br><span class="line">        _name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> <span class="keyword">int</span> <span class="title">getAnnualCost</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Party</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Employee</span>(<span class="title">String</span> <span class="title">name</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAnnualCost</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Department</span> <span class="keyword">extends</span> <span class="title">Party</span>...</span></span><br></pre></td></tr></table></figure>

<h5 id="Extract-Interface（提炼接口）"><a href="#Extract-Interface（提炼接口）" class="headerlink" title="Extract Interface（提炼接口）"></a>Extract Interface（提炼接口）</h5><p>若干客户使用类接口中的同一子集，或者两个类的接口有部分相同。将相同子集提炼到一个独立接口中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getRate</span>() </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasSpecialSkill</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDepartment</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line">Interface Billable &#123;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getRate</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">hasSpecialSkill</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">implements</span> <span class="title">Billable</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getRate</span>() </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasSpecialSkill</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDepartment</span><span class="params">()</span> </span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Collapse-Hierachy（折叠继承体系）"><a href="#Collapse-Hierachy（折叠继承体系）" class="headerlink" title="Collapse Hierachy（折叠继承体系）"></a>Collapse Hierachy（折叠继承体系）</h5><p>超类和子类之间无太大区别，将它们合为一体。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Form-Template-Method（塑造模板函数）"><a href="#Form-Template-Method（塑造模板函数）" class="headerlink" title="Form Template Method（塑造模板函数）"></a>Form Template Method（塑造模板函数）</h5><p>你有一些子类，其中相应的某些函数以相同顺序执行类似的操作，但各个操作的细节上有所不同。将这些操作分别放进独立函数中，并保持它们都有相同的签名，于是原函数也就变得相同了。然后将原函数上移至超类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">textStatement</span>() </span>&#123;</span><br><span class="line">        Enumeration rentals = _rentals.elements();</span><br><span class="line">        String result = <span class="string">"Rental Record for "</span> + getName() + <span class="string">"\n"</span>;</span><br><span class="line">        <span class="keyword">while</span>(rentals.hasMoreElements()) &#123;</span><br><span class="line">            Rental each = (Rental) rentals.nextElement();</span><br><span class="line">            result += <span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">"\t"</span> + </span><br><span class="line">                String.valueof(each.getCharge()) + <span class="string">"\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result += <span class="string">"Amount owed is "</span> + String.valueof(getTotalCharge()) + <span class="string">"\n"</span>;</span><br><span class="line">        result += <span class="string">"You earned "</span> + String.valueof(getTotalFrequentRenterPointers()) + <span class="string">" frequent renter points"</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">htmlStatement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Enumeration rentals = _rentals.elements();</span><br><span class="line">        String result = <span class="string">"&lt;H1&gt;Rental Record for &lt;EM&gt;"</span> + getName() + <span class="string">"&lt;/EM&gt;&lt;/H1&gt;&lt;P&gt;\n"</span>;</span><br><span class="line">        <span class="keyword">while</span>(rentals.hasMoreElements()) &#123;</span><br><span class="line">            Rental each = (Rental) rentals.nextElement();</span><br><span class="line">            result += <span class="string">"\t"</span> + each.getMovie().getTitle() + <span class="string">": "</span> + </span><br><span class="line">                String.valueof(each.getCharge()) + <span class="string">"&lt;BR&gt;\n"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result += <span class="string">"&lt;P&gt;Amount owed is &lt;EM&gt;"</span> + String.valueof(getTotalCharge()) + <span class="string">"&lt;/EM&gt;&lt;P&gt;\n"</span>;</span><br><span class="line">        result += <span class="string">"You earned &lt;EM&gt;"</span> + String.valueof(getTotalFrequentRenterPointers()) + <span class="string">"&lt;/EM&gt; frequent renter points&lt;P&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Customer</span>(<span class="title">Statement</span> <span class="title">statement</span>) </span>&#123;</span><br><span class="line">        _statement = statement;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">statement</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _statement.value(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Statement _statement;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Statement</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">value</span>(<span class="title">Customer</span> <span class="title">customer</span>) </span>&#123;</span><br><span class="line">        Enumeration rentals = customer.getRentals();</span><br><span class="line">        String result = headerString(customer);</span><br><span class="line">        <span class="keyword">while</span> (rentals.hasMoreElements()) &#123;</span><br><span class="line">            Rental each = (Rental) rentals.nextElement();</span><br><span class="line">            result += eachRentalString(each);</span><br><span class="line">        &#125;</span><br><span class="line">        result + footerString(customer);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> String <span class="title">headerString</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> String <span class="title">eachRentalString</span><span class="params">(Rental rental)</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">abstract</span> String <span class="title">footerString</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TextStatement</span> <span class="keyword">extends</span> <span class="title">Statement</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">headerString</span>(<span class="title">Customer</span> <span class="title">customer</span>)</span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">eachRentalString</span><span class="params">(Rental rental)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">footerString</span><span class="params">(Customer customer)</span></span>&#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HtmlStatement</span> <span class="keyword">extends</span> <span class="title">Statement</span>...</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">headerString</span>(<span class="title">Customer</span> <span class="title">customer</span>)</span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">eachRentalString</span><span class="params">(Rental rental)</span></span>&#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">footerString</span><span class="params">(Customer customer)</span></span>&#123;...&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Inheritance-with-Delegation（以委托取代继承）"><a href="#Replace-Inheritance-with-Delegation（以委托取代继承）" class="headerlink" title="Replace Inheritance with Delegation（以委托取代继承）"></a>Replace Inheritance with Delegation（以委托取代继承）</h5><p>某个子类只使用超类接口中的一部分，或是根本不需要继承而来的数据。在子类中新建一个字段用以保存超类；调用子类函数，令它改而委托超类；然后去掉两者之间的继承关系。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> <span class="keyword">extends</span> <span class="title">Vector</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object elememt)</span> </span>&#123;</span><br><span class="line">        insertElementAt(element, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Object result = firstElement();</span><br><span class="line">        removeElementAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// extend size() and isEmpty()</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyStack</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Vector _vector;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Object element)</span> </span>&#123;</span><br><span class="line">        _vector.insertElementAt(element, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Object result = _vector.firstElement();</span><br><span class="line">        _vector.removeElementAt(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _vector.size();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _vector.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Replace-Delegation-with-Inheritance（以继承取代委托）"><a href="#Replace-Delegation-with-Inheritance（以继承取代委托）" class="headerlink" title="Replace Delegation with Inheritance（以继承取代委托）"></a>Replace Delegation with Inheritance（以继承取代委托）</h5><p>你在两个类之间使用委托关系，并经常为整个接口编写许多极简单的委托函数。让委托继承受托类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*==============Before refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    Person _person = <span class="keyword">new</span> Person();</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _person.getName();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        _person.setName(arg);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Emp: "</span> + _person.getLastName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String _name;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String arg)</span> </span>&#123;</span><br><span class="line">        _name = arg;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLastName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> _name.substring(_name.lastIndexOf(<span class="string">' '</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*==============After refactor=================*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Employee</span> <span class="keyword">extends</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Emp: "</span> + getLastName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h4 id="大型重构"><a href="#大型重构" class="headerlink" title="大型重构"></a>大型重构</h4><h5 id="Tease-Apart-Inheritance（梳理并分解继承体系）"><a href="#Tease-Apart-Inheritance（梳理并分解继承体系）" class="headerlink" title="Tease Apart Inheritance（梳理并分解继承体系）"></a>Tease Apart Inheritance（梳理并分解继承体系）</h5><p>某个继承体系同时承担两项责任，建立两个继承体系，并通过委托关系让其中一个可以调用另一个。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Convert-Procedural-Design-to-Objects（将过程化设计转化为对象设计）"><a href="#Convert-Procedural-Design-to-Objects（将过程化设计转化为对象设计）" class="headerlink" title="Convert Procedural Design to Objects（将过程化设计转化为对象设计）"></a>Convert Procedural Design to Objects（将过程化设计转化为对象设计）</h5><p>对于已有的一些传统过程化风格的代码，将数据记录变成对象，将大块的行为分成小块，并将行为移入相关对象之中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Separate-Domain-from-Presentation（将领域和表述-显示分离）"><a href="#Separate-Domain-from-Presentation（将领域和表述-显示分离）" class="headerlink" title="Separate Domain from Presentation（将领域和表述/显示分离）"></a>Separate Domain from Presentation（将领域和表述/显示分离）</h5><p>某些GUI类之中包含了领域逻辑，将领域逻辑分离出来，为它们建立独立的领域类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>

<h5 id="Extract-Hierarchy（提炼继承体系）"><a href="#Extract-Hierarchy（提炼继承体系）" class="headerlink" title="Extract Hierarchy（提炼继承体系）"></a>Extract Hierarchy（提炼继承体系）</h5><p>若针对某个类做了太多工作，其中一部分工作是以大量条件表达式完成的。建立继承体系，以一个子类表示一种特殊情况。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 代码略。</span></span><br></pre></td></tr></table></figure>


      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/重构/" rel="tag"># 重构</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/15/Spring源码学习笔记/" rel="next" title="Spring源码学习笔记">
                <i class="fa fa-chevron-left"></i> Spring源码学习笔记
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/01/01/Java类加载详解/" rel="prev" title="Java类加载详解">
                Java类加载详解 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://ww3.sinaimg.cn/mw690/eab689f0jw8f12gq1h4q0j20ig0igjsh.jpg" alt="RicheyCheng">
            
              <p class="site-author-name" itemprop="name">RicheyCheng</p>
              <p class="site-description motion-element" itemprop="description">认真生活，快乐工作</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">18</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/richeycheng" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:chengxiaofuzju@gmail.com" target="_blank" title="Email">
                      
                        <i class="fa fa-fw fa-envelope"></i>Email</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#概述-—-问题与方案"><span class="nav-text">概述 — 问题与方案</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重新组织函数"><span class="nav-text">重新组织函数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Method（提炼函数）"><span class="nav-text">Extract Method（提炼函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Inline-Method（内联函数）"><span class="nav-text">Inline Method（内联函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Inline-Temp（内联临时变量）"><span class="nav-text">Inline Temp（内联临时变量）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Temp-with-Query（以查询取代临时变量）"><span class="nav-text">Replace Temp with Query（以查询取代临时变量）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Explaining-Variable（引入解释性变量）"><span class="nav-text">Introduce Explaining Variable（引入解释性变量）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Split-Temporary-Variable（分解临时变量）"><span class="nav-text">Split Temporary Variable（分解临时变量）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-Assignments-to-Parameters（移除对参数的赋值）"><span class="nav-text">Remove Assignments to Parameters（移除对参数的赋值）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Method-with-Method-Object（以函数对象取代函数）"><span class="nav-text">Replace Method with Method Object（以函数对象取代函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Substitute-Algorithm（替换算法）"><span class="nav-text">Substitute Algorithm（替换算法）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#在对象之间搬移特性"><span class="nav-text">在对象之间搬移特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Move-Method（搬移函数）"><span class="nav-text">Move Method（搬移函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Move-Field（搬移字段）"><span class="nav-text">Move Field（搬移字段）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Class（提炼类）"><span class="nav-text">Extract Class（提炼类）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Inline-Class（将类内联化）"><span class="nav-text">Inline Class（将类内联化）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hide-Delegate（隐藏“委托关系”）"><span class="nav-text">Hide Delegate（隐藏“委托关系”）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-Middle-Man（移除中间人）"><span class="nav-text">Remove Middle Man（移除中间人）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Foreign-Method（引入外加函数）"><span class="nav-text">Introduce Foreign Method（引入外加函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Local-Extension（引入本地扩展）"><span class="nav-text">Introduce Local Extension（引入本地扩展）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#重新组织数据"><span class="nav-text">重新组织数据</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Self-Encapsulate-Field（自封装字段）"><span class="nav-text">Self Encapsulate Field（自封装字段）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Data-Value-with-Object（以对象取代数据值）"><span class="nav-text">Replace Data Value with Object（以对象取代数据值）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Change-Value-to-Reference（将值对象改为引用对象）"><span class="nav-text">Change Value to Reference（将值对象改为引用对象）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Change-Reference-to-Value（将引用对象改为值对象）"><span class="nav-text">Change Reference to Value（将引用对象改为值对象）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Array-with-Object（以对象取代数组）"><span class="nav-text">Replace Array with Object（以对象取代数组）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Duplicate-Observed-Data（复制“被监视数据”）"><span class="nav-text">Duplicate Observed Data（复制“被监视数据”）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Change-Unidirectional-Association-to-Bidirectional（将单向关联改为双向关联）"><span class="nav-text">Change Unidirectional Association to Bidirectional（将单向关联改为双向关联）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Change-Bidirectional-Association-to-Unidirectional（将双向关联改为单向关联）"><span class="nav-text">Change Bidirectional Association to Unidirectional（将双向关联改为单向关联）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Magic-Number-with-symbolic-Constant（以字面常量取代魔法数）"><span class="nav-text">Replace Magic Number with symbolic Constant（以字面常量取代魔法数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Encapsulate-Field（封装字段）"><span class="nav-text">Encapsulate Field（封装字段）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Encapsulate-Collection（封装集合）"><span class="nav-text">Encapsulate Collection（封装集合）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Record-with-Data-Class（以数据类取代记录）"><span class="nav-text">Replace Record with Data Class（以数据类取代记录）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Type-Code-with-Class（以类取代类型码）"><span class="nav-text">Replace Type Code with Class（以类取代类型码）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Type-Code-with-Subclasses（以子类取代类型码）"><span class="nav-text">Replace Type Code with Subclasses（以子类取代类型码）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Type-Code-with-State-Strategy（以State-Strategy取代类型码）"><span class="nav-text">Replace Type Code with State/Strategy（以State/Strategy取代类型码）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Subclass-with-Field（以字段取代子类）"><span class="nav-text">Replace Subclass with Field（以字段取代子类）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#简化条件表达式"><span class="nav-text">简化条件表达式</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Decompose-Conditional（分解条件表达式）"><span class="nav-text">Decompose Conditional（分解条件表达式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Consolidate-Conditional-Expression（合并条件表达式）"><span class="nav-text">Consolidate Conditional Expression（合并条件表达式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Consolidate-Duplicate-Conditional-Fragments（合并重复的条件片段）"><span class="nav-text">Consolidate Duplicate Conditional Fragments（合并重复的条件片段）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-Control-Flag（移除控制标记）"><span class="nav-text">Remove Control Flag（移除控制标记）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Nested-Confitional-with-Guard-Clauses（以卫语句取代嵌套条件表达式）"><span class="nav-text">Replace Nested Confitional with Guard Clauses（以卫语句取代嵌套条件表达式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Conditional-with-Polymorphism（以多态取代条件表达式）"><span class="nav-text">Replace Conditional with Polymorphism（以多态取代条件表达式）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Null-Object（引入Null对象）"><span class="nav-text">Introduce Null Object（引入Null对象）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Assertion（引入断言）"><span class="nav-text">Introduce Assertion（引入断言）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#简化函数调用"><span class="nav-text">简化函数调用</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Rename-Method（函数改名）"><span class="nav-text">Rename Method（函数改名）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Add-Parameter（添加参数）"><span class="nav-text">Add Parameter（添加参数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-Parameter（移除参数）"><span class="nav-text">Remove Parameter（移除参数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Separate-Query-from-Modifier（将查询函数和修改函数分离）"><span class="nav-text">Separate Query from Modifier（将查询函数和修改函数分离）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Parameterize-Method（令函数携带参数）"><span class="nav-text">Parameterize Method（令函数携带参数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Parameter-with-Explicit-Methods（以明确函数取代参数）"><span class="nav-text">Replace Parameter with Explicit Methods（以明确函数取代参数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Preserve-Whole-object（保持对象完整）"><span class="nav-text">Preserve Whole object（保持对象完整）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Parameter-with-Methods（以函数取代参数）"><span class="nav-text">Replace Parameter with Methods（以函数取代参数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Introduce-Parameter-Object（引入参数对象）"><span class="nav-text">Introduce Parameter Object（引入参数对象）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Remove-Setting-Method（移除设值函数）"><span class="nav-text">Remove Setting Method（移除设值函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hide-Method（隐藏函数）"><span class="nav-text">Hide Method（隐藏函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Constructor-with-Factory-Method（以工厂函数取代构造函数）"><span class="nav-text">Replace Constructor with Factory Method（以工厂函数取代构造函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Encapsulate-Downcast（封装向下转型）"><span class="nav-text">Encapsulate Downcast（封装向下转型）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Error-Code-with-Exception（以异常取代错误码）"><span class="nav-text">Replace Error Code with Exception（以异常取代错误码）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Exception-with-Test（以测试取代异常）"><span class="nav-text">Replace Exception with Test（以测试取代异常）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#处理概括关系"><span class="nav-text">处理概括关系</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Pull-Up-Field（字段上移）"><span class="nav-text">Pull Up Field（字段上移）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pull-Up-Method（函数上移）"><span class="nav-text">Pull Up Method（函数上移）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Pull-Up-Constructor-Body（构造函数本体上移）"><span class="nav-text">Pull Up Constructor Body（构造函数本体上移）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Push-Down-Method（函数下移）"><span class="nav-text">Push Down Method（函数下移）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Push-Down-Field（字段下移）"><span class="nav-text">Push Down Field（字段下移）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Subclass（提炼子类）"><span class="nav-text">Extract Subclass（提炼子类）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Superclass（提炼超类）"><span class="nav-text">Extract Superclass（提炼超类）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Interface（提炼接口）"><span class="nav-text">Extract Interface（提炼接口）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Collapse-Hierachy（折叠继承体系）"><span class="nav-text">Collapse Hierachy（折叠继承体系）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Form-Template-Method（塑造模板函数）"><span class="nav-text">Form Template Method（塑造模板函数）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Inheritance-with-Delegation（以委托取代继承）"><span class="nav-text">Replace Inheritance with Delegation（以委托取代继承）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Replace-Delegation-with-Inheritance（以继承取代委托）"><span class="nav-text">Replace Delegation with Inheritance（以继承取代委托）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#大型重构"><span class="nav-text">大型重构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Tease-Apart-Inheritance（梳理并分解继承体系）"><span class="nav-text">Tease Apart Inheritance（梳理并分解继承体系）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Convert-Procedural-Design-to-Objects（将过程化设计转化为对象设计）"><span class="nav-text">Convert Procedural Design to Objects（将过程化设计转化为对象设计）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Separate-Domain-from-Presentation（将领域和表述-显示分离）"><span class="nav-text">Separate Domain from Presentation（将领域和表述/显示分离）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Extract-Hierarchy（提炼继承体系）"><span class="nav-text">Extract Hierarchy（提炼继承体系）</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RicheyCheng</span>

  
</div>









        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
